<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Provision Shop</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .btn { display: block; width: 100%; padding: 15px; margin: 10px 0; font-size: 18px; }
    .item { background: white; padding: 10px; margin: 8px 0; border-radius: 5px; }
    input, button { padding: 8px; margin: 5px; width: calc(100% - 20px); }
  </style>
</head>
<body>
  <h1>ðŸ›’ Provision Shop</h1>
  
  <button class="btn" onclick="openData()">1. Open Data (Offline)</button>
  <button class="btn" onclick="downloadData()">2. Download Data</button>
  <button class="btn" onclick="showUpdateForm()">3. Update Data</button>

  <div id="display"></div>
  <div id="form" style="display:none;">
    <h3>Add / Edit Item</h3>
    <input type="text" id="itemName" placeholder="Item name" />
    <input type="number" id="itemPrice" placeholder="Price" />
    <button onclick="addItem()">Save Item</button>
    <button onclick="deleteAll()">Delete All</button>
    <button onclick="hideForm()">Cancel</button>
  </div>



  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/provision-shop/sw.js');
    });
  }
</script>

  <script>
    // ðŸ”‘ REPLACE THIS WITH YOUR APPS SCRIPT URL FROM STEP 2
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxtiwTojYoLP4Su5e716xneQGUhXQ1Aimq09iw2VLR-hp6DtDutD0S8vw9FRtUJBbk9ow/exec";

    // Load data from local storage on start
    document.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem("prices");
      if (saved) {
        renderItems(JSON.parse(saved));
      }
    });

    function openData() {
      const data = localStorage.getItem("prices");
      if (data) {
        renderItems(JSON.parse(data));
      } else {
        document.getElementById("display").innerHTML = "<p>No data. Click 'Download Data' first.</p>";
      }
    }

    function downloadData() {
      fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(data => {
          localStorage.setItem("prices", JSON.stringify(data));
          renderItems(data);
          alert("âœ… Data downloaded!");
        })
        .catch(err => {
          alert("âŒ Failed to download. Check internet or URL.");
          console.error(err);
        });
    }

    function showUpdateForm() {
      document.getElementById("form").style.display = "block";
    }

    function hideForm() {
      document.getElementById("form").style.display = "none";
    }

    function addItem() {
      const name = document.getElementById("itemName").value.trim();
      const price = parseFloat(document.getElementById("itemPrice").value);
      if (!name || isNaN(price)) {
        alert("Please enter valid name and price.");
        return;
      }

      let items = JSON.parse(localStorage.getItem("prices") || "[]");
      const id = items.length > 0 ? Math.max(...items.map(i => i.id)) + 1 : 1;
      items.push({ id, name, price });
      
      localStorage.setItem("prices", JSON.stringify(items));
      uploadToCloud(items);
      renderItems(items);
      hideForm();
      document.getElementById("itemName").value = "";
      document.getElementById("itemPrice").value = "";
    }

    function deleteAll() {
      if (confirm("Delete all items?")) {
        localStorage.removeItem("prices");
        uploadToCloud([]);
        document.getElementById("display").innerHTML = "<p>All items deleted.</p>";
        hideForm();
      }
    }

    function uploadToCloud(data) {
      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.json())
      .then(() => console.log("Synced to cloud"))
      .catch(err => console.error("Sync failed:", err));
    }

    function renderItems(items) {
      const html = items.map(item => 
        `<div class="item">${item.name} â€” â‚¹${item.price}</div>`
      ).join("");
      document.getElementById("display").innerHTML = html || "<p>No items.</p>";
    }
  </script>
  
</body>
</html>
